<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coaching Admission Form</title>
<style>
/* your same CSS */
body { background-color: #f0f0f0; font-size: 16px; font-family: Arial, sans-serif; padding: 20px; }
#pdf-frame { width: 100%; height: 600px; border: none; display: none; margin-top: 20px; }
form { background: white; padding: 20px; border-radius: 10px; max-width: 900px; margin: auto; box-shadow: 0 0 10px #ccc; display: none; }
button { margin: 10px; padding: 10px 20px; font-size: 16px; background-color: #007BFF; color: white; border: none; border-radius: 6px; cursor: pointer; }
button:hover { background-color: #0056b3; }
label { display: block; margin-bottom: 5px; }
input[type="text"], input[type="email"], input[type="date"], select, textarea, input[type="file"] {
  width: 100%; padding: 10px; font-size: 16px; border: 1px solid #aaa; border-radius: 5px; margin-bottom: 15px;
}
textarea { resize: vertical; }
input[type="submit"] {
  background: #007BFF; color: white; padding: 10px 20px; font-size: 16px; border: none; border-radius: 6px;
  cursor: not-allowed; opacity: 0.6;
}
input[type="submit"].enabled { cursor: pointer; opacity: 1; }
input[type="submit"]:hover.enabled { background-color: #0056b3; }
.thank-you-message { display: none; max-width: 900px; margin: 20px auto; padding: 20px; background-color: #ffffff; border-radius: 10px; text-align: left; word-wrap: break-word; }
.thank-you-message h2 { text-align: center; }
.payment-box { padding: 15px; border: 1px dashed #007BFF; margin: 15px 0; text-align: left; border-radius: 8px; background: #f9f9f9; }
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.full-width { grid-column: 1 / -1; }
#photo-preview { display: none; max-width:150px; border:1px solid #ccc; border-radius:8px; padding:5px; }
#amountLabel { margin-top: 10px; font-weight: bold; color: #333; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
table, th, td { border: none; }
th, td { padding: 8px; text-align: left; }

@media (max-width: 768px) {
  body { padding: 10px; font-size: 15px; }
  form { padding: 15px; }
  .form-grid { grid-template-columns: 1fr !important; gap: 15px; }
  input[type="text"], input[type="email"], input[type="date"], select, textarea, input[type="file"] {
    font-size: 16px; padding: 12px;
  }
  button, input[type="submit"] { width: 100%; font-size: 18px; padding: 14px; }
}
@media print { button, a[href], #pdf-frame { display: none !important; } }
</style>
</head>
<body>

<div style="text-align: center;">
  <button type="button" onclick="showPDF()">PROSPECTUS</button>
  <button type="button" onclick="showForm()">Fill Admission Form</button>
</div>

<iframe id="pdf-frame" src="https://drive.google.com/file/d/1we22QTVvt33YMLwMx09HFqXeCB0Iai5a/preview"></iframe>

<form id="admission-form" action="https://formspree.io/f/xkgrbpzp" method="POST">
  <input type="hidden" name="_captcha" value="false">
  <h2>Admission Form</h2>
  <h2>G10 EDUCATIONAL PLATFORM</h2>

  <!-- same form fields as before -->
  <div class="form-grid">
    <div class="full-width"><label>Full Name:</label><input type="text" name="name" required></div>
    <div><label>Email:</label><input type="email" name="email" required></div>
    <div><label>Student Phone:</label><input type="text" name="student_phone" required></div>
    <div class="full-width"><label>School Name:</label><input type="text" name="school" required></div>
    <div><label>Gender:</label><select name="gender" required><option value="">--Select--</option><option>Male</option><option>Female</option><option>Other</option></select></div>
    <div><label>Date of Birth:</label><input type="date" name="dob" required></div>

    <div><label>Course:</label>
      <select name="course" required>
        <option value="">--Select Course--</option>
        <option>IIT-JEE</option><option>NEET</option><option>Foundation</option>
        <option>CLASS 9 CBSE</option><option>CLASS 10 CBSE</option>
        <option>CLASS 11 CBSE</option><option>CLASS 12 CBSE</option>
      </select>
    </div>

    <div><label>Service Type:</label>
      <select name="service_type" required>
        <option value="">--Select Service--</option>
        <option>HOME TUITION</option><option>INDIVIDUAL COACHING</option>
        <option>ONLINE COACHING</option><option>DUAL COACHING</option>
        <option>GROUP COACHING</option><option>SPECIAL GROUP COACHING</option>
      </select>
    </div>

    <div><label>Subject:</label>
      <select name="subject" required>
        <option value="">--Select Subject--</option>
        <option>Physics</option><option>Chemistry</option><option>Math</option><option>Biology</option>
      </select>
    </div>
    <div><label>Preparing for:</label><input type="text" name="preparing_for" required></div>

    <div class="full-width"><label>Present Address:</label><textarea name="address" rows="3" required></textarea></div>
    <div><label>Parent Name:</label><input type="text" name="parent_name" required></div>
    <div><label>Parent Phone:</label><input type="text" name="parent_phone" required></div>
    <div class="full-width"><label>Message:</label><textarea name="message" rows="4"></textarea></div>

    <div class="full-width">
      <label>Passport Size Photo (Mandatory, ≤80KB):</label>
      <input type="file" id="photo-file" accept="image/*" required onchange="previewPhoto(event)">
      <input type="hidden" name="photo_url" id="photo-url">
      <input type="hidden" name="photo_delete_url" id="photo-delete-url">
      <img id="photo-preview" src="" alt="Photo Preview">
    </div>

    <div class="full-width payment-box">
      <h3>Pay Admission Fee</h3>
      <button type="button" id="payNowBtn">Pay now</button>
      <div id="amountLabel"></div>
    </div>
  </div>

  <input type="submit" id="submitBtn" value="Submit" disabled>
</form>

<div class="thank-you-message" id="thank-you">
  <h2>Thank You, <span id="thank-name"></span>!</h2>
  <p>We have received your form for the <strong><span id="thank-course"></span></strong> course.</p>
  <p>A confirmation has been sent to <strong><span id="thank-email"></span></strong>.</p>
  <div style="text-align:center; margin-top: 20px;">
    <a href="https://g10educationalplatformindia.co.in/">Go to Home</a>
  </div>
</div>

<script>
function showPDF(){ document.getElementById('pdf-frame').style.display='block'; document.getElementById('admission-form').style.display='none'; document.getElementById('thank-you').style.display='none'; }
function showForm(){ document.getElementById('admission-form').style.display='block'; document.getElementById('pdf-frame').style.display='none'; document.getElementById('thank-you').style.display='none'; }

let validPhoto=false;
function previewPhoto(e){
  const file=e.target.files[0];
  const preview=document.getElementById('photo-preview');
  validPhoto=false;
  if(file){
    if(file.size>80*1024){ alert("File size exceeds 80 KB."); e.target.value=""; preview.src=""; preview.style.display="none"; return;}
    validPhoto=true;
    const reader=new FileReader();
    reader.onload=ev=>{preview.src=ev.target.result; preview.style.display='block';}
    reader.readAsDataURL(file);
  } else {preview.src=""; preview.style.display='none';}
}

// ✅ Cashfree Payment Integration
document.getElementById("payNowBtn").addEventListener("click", async () => {
  const service = document.querySelector("select[name='service_type']").value;
  let amount = 0;
  if (["HOME TUITION", "INDIVIDUAL COACHING", "ONLINE COACHING", "DUAL COACHING"].includes(service)) amount = 49;
  else if (["GROUP COACHING", "SPECIAL GROUP COACHING"].includes(service)) amount = 99;

  if (!amount) return alert("Please select a valid service type before payment.");

  const name = document.querySelector("input[name='name']").value.trim();
  const email = document.querySelector("input[name='email']").value.trim();

  if (!name || !email) return alert("Please enter your name and email before payment.");

  // Create order using backend
  const res = await fetch("https://admision-from.onrender.com/pay", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ amount, name, email })
  });

  const data = await res.json();

  if (data?.success && data?.paymentLink) {
    localStorage.setItem("pendingOrderId", data.orderId);
    window.location.href = data.paymentLink; // Redirect to Cashfree
  } else {
    alert("Payment creation failed. Please try again.");
  }
});

// ✅ When Cashfree redirects back after payment success
window.addEventListener("load", async () => {
  const urlParams = new URLSearchParams(window.location.search);
  const orderId = urlParams.get("order_id");

  if (orderId) {
    const verify = await fetch("https://admision-from.onrender.com/verify-payment", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ orderId })
    });
    const data = await verify.json();

    if (data.success && data.verified) {
      const btn = document.getElementById("submitBtn");
      btn.disabled = false;
      btn.classList.add("enabled");
      document.getElementById("amountLabel").innerHTML =
        `<span style="color:green;font-weight:bold;">Payment Successful ✅<br>Access Code: ${data.code}</span>`;
    } else {
      document.getElementById("amountLabel").innerHTML =
        `<span style="color:red;">Payment not verified. Please try again.</span>`;
    }
  }
});
</script>
</body>
</html>
